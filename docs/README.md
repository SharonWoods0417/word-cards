# 儿童单词卡片生成工具

## 📌 项目背景

我正在为我的孩子开发一个网页应用，用于生成"单词卡片"。这些卡片将被导出为 PDF 或图片，用于打印、剪裁和正反面对齐使用。用户可以通过上传 CSV 或手动输入单词的方式添加内容。

每张卡片正面包括：单词、图片、音标、自然拼读  
每张卡片背面包括：中文释义、英文例句及对应的中文解释

### 🚀 核心特性
- **AI智能补全**：使用GPT-4o-mini模型自动生成音标、释义、例句
- **图片自动搜索**：基于Pexels API自动获取高质量相关图片
- **批量处理**：支持单个和批量补全，提升制作效率
- **实时预览**：所见即所得的卡片预览效果
- **精确打印**：A4纸张优化，支持双面打印

### 🎯 目标用户
- 主要用户：家长和英语教师
- 使用场景：为儿童制作英语学习卡片
- 核心需求：快速生成高质量、可打印的单词卡片

## ⚙️ 技术栈

### 前端框架
- **Next.js 15.2.4** (App Router) - React 框架
- **TypeScript 5** - 类型安全
- **React 19** - 用户界面库

### 样式与UI
- **Tailwind CSS 4.1.9** - 实用优先的CSS框架
- **shadcn/ui** - 基于Radix UI的组件库
- **Geist** - 字体系统

### 核心功能库
- **pdf-lib** - 精准A4布局PDF导出

### AI服务集成
- **OpenRouter API** - 文本字段智能补全（GPT-4o-mini模型）
- **Pexels API** - 单词配图自动获取（高质量免费图片）

### 开发工具
- **pnpm/npm** - 包管理器
- **ESLint** - 代码质量检查

## 📂 数据结构

### 单词卡片字段说明

每个单词数据对象包含以下字段：

| 字段名 | 类型 | 用途 | 展示面 | 补全来源 |
|--------|------|------|--------|----------|
| `word` | string | 单词本身 | 正面 | 用户输入 |
| `phonetic` | string | 音标 | 正面 | OpenRouter API |
| `phonics` | string | 自然拼读拆解 | 正面 | 用户输入 |
| `imageUrl` | string | 单词对应图片地址 | 正面 | Pexels API |
| `chinese` | string | 中文释义 | 反面 | OpenRouter API |
| `example` | string | 英文例句 | 反面 | OpenRouter API |
| `translation` | string | 中文例句翻译 | 反面 | OpenRouter API |

### 数据存储
- 使用 React `useState` 管理应用状态
- 使用 `localStorage` 进行客户端数据持久化
- 无需后端服务器，纯前端应用

## ✅ 功能流程（MVP阶段）

### 1. 数据输入阶段
- **CSV上传**：支持批量导入单词词条
- **手动添加**：添加空白行，逐条输入
- **格式支持**：标准CSV格式，包含所有字段

### 2. 数据编辑阶段
- **表格编辑**：在表格中编辑所有字段内容
- **实时保存**：编辑内容自动保存到本地存储
- **数据验证**：基础字段验证和格式检查

### 3. 智能补全阶段
- **OpenRouter补全**：自动补全 `phonetic`, `chinese`, `example`, `translation`
- **Pexels补全**：自动获取 `imageUrl` 相关图片
- **单条补全**：为每个词条提供"补全"按钮
- **批量补全**：提供"补全全部"功能
- **进度显示**：实时显示补全进度和错误信息
- **智能优化**：只补全空字段，避免重复请求

### 4. 预览阶段
- **实时预览**：卡片正反面样式实时展示
- **布局预览**：展示最终打印效果
- **响应式设计**：适配不同屏幕尺寸

### 5. 导出阶段
- **PDF导出**：精准对齐，正反面对称
- **打印优化**：针对A4纸张优化

## 🖨️ 导出要求

### PDF导出规格
- **页面尺寸**：A4（210mm × 297mm）
- **卡片布局**：2列 × 3行，共6张卡片
- **卡片尺寸**：75mm × 90mm (5:6比例)
- **间距设置**：左右间距10mm，上下间距6mm
- **边距设置**：上边距6mm，下边距10mm，侧边距10mm
- **正反面**：分别生成两页，位置严格对应
- **技术方案**：使用 `pdf-lib` 控制坐标与间距
- **统一布局**：与打印预览使用相同布局参数

### 打印要求
- **双面打印**：支持"短边翻转"设置
- **精确对齐**：正反面卡片位置完全对应
- **清晰度**：避免截图导出，确保内容清晰
- **尺寸可控**：使用物理尺寸单位（mm/pt）
- **统一布局**：PDF导出与打印预览完全一致

### 卡片内容布局
- **正面布局**：
  - 图片（上40%区域）
  - 单词 + 音标（靠近显示）
  - 自然拼读拆解
- **反面布局**：
  - 中文释义（上40%，灰底背景）
  - 英文例句 + 中文翻译（紧贴展示）

## 🔁 AI补全功能

### OpenRouter API集成
- **补全字段**：`phonetic`, `chinese`, `example`, `translation`
- **调用方式**：REST API调用
- **提示词模板**：针对不同字段优化的提示词
- **错误处理**：网络错误和API限制处理

### Pexels API集成
- **补全字段**：`imageUrl`
- **搜索策略**：根据单词搜索相关图片
- **图片质量**：优先选择高质量、相关度高的图片
- **备用方案**：搜索失败时的处理机制

### 用户界面
- **单条补全**：每个词条行的"补全"按钮
- **批量补全**：全局"补全全部"按钮
- **进度显示**：补全过程的进度条和状态
- **AI标记**：tooltip或图标标识AI生成内容
- **取消功能**：支持中途取消补全操作

## 📁 项目结构

```
word-cards-workspace/
├── app/                    # Next.js App Router 页面
│   ├── workspace/         # 主要工作页面
│   ├── layout.tsx         # 根布局
│   └── globals.css        # 全局样式
├── components/            # UI 组件
│   ├── ui/               # shadcn/ui 基础组件（精简版）
│   ├── completion-button.tsx      # 单个补全按钮
│   └── bulk-completion-button.tsx # 批量补全按钮
├── hooks/                 # React Hooks
│   └── use-completion.ts  # 补全功能 Hook
├── lib/                   # 工具函数
│   ├── api.ts            # API 调用工具
│   └── utils.ts          # 通用工具函数
├── docs/                  # 项目文档
│   ├── README.md         # 项目主要参考文档（本文件）
│   └── API_SETUP.md      # API 配置说明
├── public/                # 静态资源
│   ├── open-book.png     # 示例图片
│   └── red-apple.png     # 示例图片
└── package.json          # 项目配置
```

## 🎯 MVP 开发任务清单

### 🔄 **第一阶段：数据管理基础**

#### 1.1 数据结构定义
- [x] 定义 Word 接口类型
- [x] 创建示例数据数组
- [x] 设置 React state 管理单词列表
- [x] 实现 localStorage 数据持久化

#### 1.2 手动添加单词
- [x] 实现"添加单词"按钮功能
- [x] 创建新的空白单词条目
- [x] 为新单词生成唯一 ID
- [x] 将新单词添加到状态中

#### 1.3 表格编辑功能
- [x] 实现所有输入框的双向绑定
- [x] 实现删除单词功能
- [x] 添加基本的输入验证

### 📁 **第二阶段：CSV 文件上传**

#### 2.1 文件上传界面
- [x] 实现文件拖拽上传功能
- [x] 添加文件类型验证（CSV）
- [x] 显示上传状态提示

#### 2.2 CSV 解析功能
- [x] 解析上传的 CSV 文件内容
- [x] 验证 CSV 格式和字段映射
- [x] 将 CSV 数据转换为单词对象
- [x] 合并数据到现有单词列表

### 🎨 **第三阶段：卡片预览**

#### 3.1 预览数据绑定
- [x] 将表格数据实时同步到预览区域
- [x] 实现正面/反面预览切换
- [x] 处理空数据状态显示

#### 3.2 卡片样式实现
- [x] 实现正面卡片布局（图片、单词、音标、拼读）
- [x] 实现反面卡片布局（中文释义、例句、翻译）
- [x] 添加图片加载失败处理

### 🖨️ **第四阶段：导出功能**

#### 4.1 基础导出设置
- [x] 实现每页卡片数量选择（4/6/8张）
- [x] 添加对齐方式设置（双面/单面）

#### 4.2 PDF 导出（强化版）
- [x] 集成 `pdf-lib` 库（替代 jsPDF）
- [x] 使用物理尺寸单位（mm/pt）而非 px
- [x] 设置 A4 纸张尺寸（210mm × 297mm）
- [x] 实现固定 3 行 × 2 列布局
- [x] 设置卡片尺寸为 90mm × 60mm
- [x] 使用固定坐标精确定位每张卡片
- [x] 生成正面页面（图片+单词+音标+拼读）
- [x] 生成反面页面（中文释义+例句+翻译）
- [x] 确保正反面卡片位置一一对应
- [x] 添加 PDF 下载功能
- [x] 支持"短边翻转"双面打印设置

#### 4.3 卡片内容结构
- [x] 正面布局：图片（上40%）+ 单词+音标（靠近）+ 拼读拆分
- [x] 反面布局：灰底中文释义（上40%）+ 英文例句+中文翻译（紧贴）
- [x] 确保打印时排版与网页预览效果完全一致

#### 4.4 JPG 导出（已移除）
- [x] ~~集成 html2canvas 库~~ （已移除）
- [x] ~~实现卡片截图功能~~ （已移除）
- [x] ~~生成高质量图片~~ （已移除）
- [x] ~~添加图片下载功能~~ （已移除）

**说明**：JPG导出功能由于技术兼容性问题已被移除，PDF导出功能完全满足需求。

### 🤖 **第五阶段：字段自动补全**

#### 5.1 API 集成准备
- [x] 配置 OpenRouter API 密钥管理
- [x] 配置 Pexels API 密钥管理
- [x] 创建 API 调用工具函数
- [x] 添加环境变量配置

#### 5.2 文本字段补全（OpenRouter API）
- [x] 实现 OpenRouter API 调用函数
- [x] 创建文本补全提示词模板
- [x] 补全 phonetic（音标）字段
- [x] 补全 chinese（中文释义）字段
- [x] 补全 example（英文例句）字段
- [x] 补全 translation（例句翻译）字段

#### 5.3 图片字段补全（Pexels API）
- [x] 实现 Pexels API 调用函数
- [x] 根据单词搜索相关图片
- [x] 补全 imageUrl 字段（搜索首张相关图片）
- [x] 添加图片质量筛选

#### 5.4 用户界面集成
- [x] 为每个词条添加"补全"按钮
- [x] 添加"补全全部"按钮
- [x] 实现补全 loading 状态
- [x] 添加补全错误处理
- [x] 显示补全进度提示

#### 5.5 补全逻辑优化
- [x] 只补全当前为空的字段（避免重复请求）
- [ ] 添加"AI 补全来源"标记（tooltip 或图标标识）
- [x] 在"补全全部"功能中按词条逐条处理
- [ ] 支持中途取消补全操作
- [x] 反馈失败信息给用户
- [x] 补全结果验证
- [ ] 添加补全历史记录

## 🚫 延后功能（当前不做）

以下功能将在MVP完成后逐步添加：

### 编辑功能延后
- [ ] 粘贴多行导入功能
- [ ] 批量添加功能
- [ ] 表格行高亮显示
- [ ] 高级输入验证

### 预览功能延后
- [ ] 卡片点击放大预览
- [ ] 预览缩放控制
- [ ] 预览模式切换
- [ ] 预览筛选功能

### 导出功能延后
- [x] ~~卡片间距调节~~ （已实现）
- [x] ~~页面边距设置~~ （已实现）
- [x] ~~纸张尺寸选择~~ （已实现）
- [ ] 打印预览页面

### UI 优化延后
- [ ] 暗黑模式支持
- [ ] 键盘快捷键
- [ ] 加载状态指示器
- [ ] 操作提示消息
- [ ] 响应式布局优化

### 性能优化延后
- [ ] 虚拟滚动
- [ ] 图片懒加载
- [ ] 数据缓存机制
- [ ] 撤销/重做功能

## 🎯 MVP 成功标准

### 功能完整性
- ✅ 可以上传 CSV 文件并正确解析
- ✅ 可以手动添加新单词
- ✅ 可以编辑所有单词字段
- ✅ 可以实时预览卡片效果
- ✅ 可以导出为 PDF（高质量打印格式）
- ✅ 可以自动补全单词字段（AI驱动）
- ✅ 可以自动搜索相关图片

### 用户体验
- ✅ 界面响应流畅
- ✅ 数据保存可靠
- ✅ 导出功能正常
- ✅ 无明显错误

### 技术实现
- ✅ 代码结构清晰
- ✅ 类型定义完整
- ✅ 错误处理基本到位
- ✅ 可以正常运行

## 🚀 开发优先级

1. **最高优先级**：数据管理基础（第一阶段）
2. **高优先级**：CSV 上传功能（第二阶段）
3. **中优先级**：卡片预览功能（第三阶段）
4. **中优先级**：导出功能（第四阶段）
5. **高优先级**：字段自动补全（第五阶段）

## 💡 开发建议

### 技术选型
- **状态管理**：使用 React useState + localStorage
- **文件处理**：使用 FileReader API
- **PDF 导出**：使用 `pdf-lib`（物理尺寸，精确布局）
- **AI 补全**：OpenRouter API（文本）+ Pexels API（图片）

### 开发流程
1. 先完成数据管理，确保基础功能正常
2. 再实现 CSV 上传，扩展数据来源
3. 然后完善预览功能，提升用户体验
4. 接着实现导出功能，完成核心闭环
5. 最后添加字段自动补全，提升效率

### 测试重点
- CSV 文件解析的准确性
- 数据编辑的实时性
- 预览效果的准确性
- PDF导出文件的质量（特别是打印对齐）
- AI 补全功能的可靠性

## 🔧 开发方式

### 当前开发状态
- 项目已完成基础架构搭建
- 正在进行MVP功能逐项开发
- 按照本文档的任务清单推进

### 上下文恢复
- 每次新开Chat时，只需说"请阅读 /docs/README.md"
- 即可自动恢复项目完整上下文
- 无需重新解释项目背景和技术栈

## 🤖 AI补全功能详解

### 功能特点
- **智能文本生成**：使用GPT-4o-mini模型生成高质量的音标、释义、例句
- **图片自动匹配**：基于单词语义搜索相关的高质量图片
- **批量处理能力**：支持单个和批量补全，大幅提升制作效率
- **错误处理机制**：完善的错误提示和重试机制

### 使用方式
1. **单个补全**：点击单词条目旁的魔法棒图标
2. **批量补全**：点击"补全全部"按钮处理所有单词
3. **进度监控**：实时显示补全进度和成功/失败状态
4. **结果验证**：自动验证补全结果的有效性

### 技术实现
- **API集成**：OpenRouter API + Pexels API
- **错误处理**：完善的网络错误和API限制处理
- **用户体验**：Loading状态、进度条、错误提示
- **性能优化**：请求间隔控制，避免API限制

## 📋 相关文档

- **API_SETUP.md** - OpenRouter和Pexels API配置指南
- **CHANGELOG.md** - 项目更新日志
- **EXPORT_GUIDE.md** - PDF导出功能使用指南

---

**项目状态**：第五阶段基本完成，AI补全功能已实现，图片显示已优化  
**最后更新**：2024-12-19  
**版本**：v1.4 